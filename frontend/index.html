<!doctype html><html lang="en"><head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Student Management</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head><body class="p-4"><div class="container">
<h1 class="mb-4">Student Management</h1>

<h4 id="formTitle">Add / Update Student</h4>
<div class="row g-2 mb-3">
  <div class="col-md-3"><input class="form-control" id="name" placeholder="Name"></div>
  <div class="col-md-3"><input class="form-control" id="department" placeholder="Department"></div>
  <div class="col-md-3"><input class="form-control" id="student_number" placeholder="Student Number"></div>
  <div class="col-md-3 d-grid"><button class="btn btn-primary" id="saveBtn">Save</button></div>
  <input type="hidden" id="editingId">
</div>

<h4>All Students</h4>
<table class="table table-striped" id="studentTable">
  <thead><tr><th>ID</th><th>Name</th><th>Department</th><th>Student Number</th><th>Actions</th></tr></thead>
  <tbody id="studentList"></tbody>
</table>

<div class="mt-4">
  <h4>Backup & Restore</h4>
  <div class="row mb-3">
    <div class="col-md-6 d-flex gap-2 flex-wrap">
      <button class="btn btn-success" onclick="backupData()">JSON Backup</button>
      <input type="file" id="restoreFile" class="form-control w-auto">
      <button class="btn btn-warning" onclick="restoreData()">JSON Restore</button>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6 d-flex gap-2 flex-wrap">
      <button class="btn btn-outline-success" onclick="sqlBackup()">SQL Backup</button>
      <input type="file" id="sqlRestoreFile" class="form-control w-auto">
      <button class="btn btn-outline-warning" onclick="sqlRestore()">SQL Restore</button>
    </div>
  </div>
</div>

<script>
  const API='/api';

  document.getElementById("saveBtn").addEventListener("click", submitStudent);

  function submitStudent(){
    const id=document.getElementById("editingId").value;
    const data={
      name:document.getElementById("name").value,
      department:document.getElementById("department").value,
      student_number:document.getElementById("student_number").value
    };
    const url=id?`${API}/update/${id}`:`${API}/add`;
    const method=id?"PUT":"POST";
    fetch(url,{method,headers:{"Content-Type":"application/json"},body:JSON.stringify(data)})
      .then(r=>r.json()).then(()=>{resetForm();listStudents();});
  }

  function listStudents(){
    fetch(`${API}/list`).then(r=>r.json()).then(data=>{
      const list=document.getElementById("studentList"); list.innerHTML="";
      data.forEach(s=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`<td>${s.id}</td><td>${s.name}</td><td>${s.department}</td><td>${s.student_number}</td>
          <td><button class="btn btn-sm btn-secondary edit">Edit</button>
              <button class="btn btn-sm btn-danger del">Delete</button></td>`;
        tr.querySelector(".edit").addEventListener("click",()=>editStudent(s.id));
        tr.querySelector(".del").addEventListener("click",()=>deleteStudent(s.id));
        list.appendChild(tr);
      });
    });
  }

  function deleteStudent(id){ if(confirm("Delete?")) fetch(`${API}/students/${id}`,{method:"DELETE"}).then(()=>listStudents()); }
  function editStudent(id){ fetch(`${API}/read/${id}`).then(r=>r.json()).then(s=>{ 
    name.value=s.name; department.value=s.department; student_number.value=s.student_number; editingId.value=s.id; formTitle.innerText="Update Student";
  });}
  function resetForm(){ name.value=""; department.value=""; student_number.value=""; editingId.value=""; formTitle.innerText="Add / Update Student"; }

  function backupData(){ window.location.href=`${API}/backup`; }
  function restoreData(){
    const f=document.getElementById("restoreFile"); if(!f.files.length) return alert("Select JSON");
    const fd=new FormData(); fd.append("file",f.files[0]);
    fetch(`${API}/restore`,{method:"POST",body:fd}).then(r=>r.json()).then(()=>listStudents());
  }
  function sqlBackup(){ window.location.href=`${API}/sql-backup`; }
  function sqlRestore(){
    const f=document.getElementById("sqlRestoreFile"); if(!f.files.length) return alert("Select SQL");
    const fd=new FormData(); fd.append("file",f.files[0]);
    fetch(`${API}/sql-restore`,{method:"POST",body:fd}).then(r=>r.json()).then(()=>listStudents());
  }
  listStudents();
</script>
</div></body></html>